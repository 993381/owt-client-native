From ae28476531662dbb330c8b6807dc110b0ae2c230 Mon Sep 17 00:00:00 2001
From: Qiu Jianlin <jianlin.qiu@intel.com>
Date: Wed, 6 Jun 2018 16:54:25 +0800
Subject: [PATCH] Disable thin archive and isystem for linux

---
 config/c++/c++.gni       | 2 +-
 config/compiler/BUILD.gn | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/config/c++/c++.gni b/config/c++/c++.gni
index 85ffde0..b0763ff 100644
--- a/config/c++/c++.gni
+++ b/config/c++/c++.gni
@@ -12,7 +12,7 @@ declare_args() {
   # is not supported.
   use_custom_libcxx =
       is_msan || is_fuchsia ||
-      (is_linux &&
+      (is_linux && is_clang &&
        (!is_chromeos || default_toolchain != "//build/toolchain/cros:target"))
 
   # Use libc++ instead of stdlibc++ when using the host_cpu toolchain, even if
diff --git a/config/compiler/BUILD.gn b/config/compiler/BUILD.gn
index 9c7bc78..58bebde 100644
--- a/config/compiler/BUILD.gn
+++ b/config/compiler/BUILD.gn
@@ -1546,7 +1546,7 @@ config("no_rtti") {
 # 2. Remove the thin_archive config, so that the .a file actually contains all
 #    .o files, instead of just references to .o files in the build directoy
 config("thin_archive") {
-  if (is_posix && !is_nacl) {
+  if (is_posix && !is_nacl && !is_linux) {
     # TODO(thomasanderson): Enable on ChromeOS builds once
     # https://crbug.com/829956 is fixed.
     if (default_toolchain != "//build/toolchain/cros:target") {
-- 
2.7.4

